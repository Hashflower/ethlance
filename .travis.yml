language: clojure

install: make deps

script: make travis-test

before_install:

# Install Ethereum PPA
- sudo add-apt-repository --yes ppa:ethereum/ethereum
- sudo apt-get update

# Installed Latest version of dpkg (Fix for solc installation)
- sudo apt-get install dpkg --yes

# Install solc commandline tool
- sudo apt-get install solc --yes

# Retrieve IPFS client
- wget https://dist.ipfs.io/ipfs-update/v1.5.2/ipfs-update_v1.5.2_linux-amd64.tar.gz
  -O ipfs-update.tar.gz
- tar -xzf ipfs-update.tar.gz

# Update to the latest IPFS client
- ipfs-update/ipfs-update install latest
- ipfs init

# Update Node Version through nvm
- curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.34.0/install.sh | bash
- export NVM_DIR="$HOME/.nvm"
- [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
- [ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"
- nvm install 11.14.0
- nvm use 11.14.0

# Get ganache-cli commandline tool
- npm install -g ganache-cli

# Get truffle commandline tool
- npm install -g truffle

before_script:

# Deploy Truffle Migration
- make deploy

# Build the solidity contracts
- make build-contracts

# Start ganache-cli as background process
- ganache-cli > /dev/null &

# Start IPFS Daemon as background process
- ipfs daemon > /dev/null &
